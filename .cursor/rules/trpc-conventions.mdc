---
description: tRPC API development patterns and conventions
---

# tRPC Conventions

## Router Structure

- Create routers in `src/server/api/routers/` directory
- Export router with descriptive name: `export const userRouter = createTRPCRouter({...})`
- Group related procedures in the same router
- Register routers in [src/server/api/root.ts](mdc:src/server/api/root.ts)

## Procedure Patterns

```typescript
// Query pattern
getUser: publicProcedure
  .input(z.object({ id: z.string() }))
  .query(async ({ ctx, input }) => {
    return ctx.db.user.findUnique({ where: { id: input.id } });
  }),

// Mutation pattern
createUser: publicProcedure
  .input(z.object({
    name: z.string().min(1),
    email: z.string().email()
  }))
  .mutation(async ({ ctx, input }) => {
    return ctx.db.user.create({ data: input });
  }),
```

## Client Usage

- Import client API: `import { api } from "@/trpc/react"`
- Use `api.router.procedure.useQuery()` for queries
- Use `api.router.procedure.useMutation()` for mutations
- Use `api.useUtils()` for cache invalidation
- Use `useSuspenseQuery` for data that must exist

## Type Safety

- Import types: `import { type RouterInputs, type RouterOutputs } from "@/trpc/react"`
- Use type helpers: `type UserInput = RouterInputs["user"]["create"]`
- Leverage tRPC's full-stack type safety

## Context Usage

- Access database via `ctx.db` (Prisma client)
- Add new context properties in [src/server/api/trpc.ts](mdc:src/server/api/trpc.ts)
- Keep context minimal and focused
